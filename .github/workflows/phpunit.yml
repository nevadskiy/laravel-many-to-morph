name: PHPUnit

on: [push]

jobs:
    test:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                phpunit_image: ['php:8.0-cli-alpine']
                composer_prefer_lowest: [0, 1]

        env:
            PHPUNIT_IMAGE: ${{ matrix.phpunit_image }}
            COMPOSER_PREFER_LOWEST: ${{ matrix.composer_prefer_lowest }}
            COMPOSER_PREFER_STABLE: 1

        steps:
            - name: Checkout code
              uses: actions/checkout@v2

            - name: Build Docker containers
              run: docker compose build

            - name: Install Composer dependencies
              run: docker compose run composer install --no-interaction --no-progress

            - name: Run PHPUnit
              run: docker compose run phpunit
